<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .balance {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="balance">
        <h2>Балансуя:</h2>
        <p id="balance">wallet not connected</p>
        <ul id="currencyBalances" style="display: none;">
            <li><strong>Баланс в рублях (RUB): </strong><span id="rub"></span> ₽</li>
            <li><strong>Баланс в долларах (USD): </strong><span id="usd"></span> $</li>
            <li><strong>Баланс в евро (EUR): </strong><span id="eur"></span> €</li>
            <li><strong>Баланс в китайских юанях (CNY): </strong><span id="cny"></span> 元</li>
        </ul>
    </div>

    <script>
        // Проверка наличия MetaMask
        if (typeof window.ethereum === 'undefined') {
            document.getElementById('balance').innerText = 'wallet not connected';
        } else {
            // Попытка подключения к MetaMask
            window.ethereum.request({ method: 'eth_requestAccounts' })
                .then(async () => {
                    const web3 = new Web3(window.ethereum);
                    const accounts = await web3.eth.getAccounts();
                    const account = accounts[0];

                    // Получаем баланс в Wei и конвертируем в Ether
                    const balanceWei = await web3.eth.getBalance(account);
                    const balanceEth = parseFloat(web3.utils.fromWei(balanceWei, 'ether'));

                    // Проверка корректности суммы
                    if (isNaN(balanceEth)) {
                        document.getElementById('balance').innerText = 'Ошибка: неверный баланс';
                        return;
                    }

                    // Обновляем баланс на странице
                    document.getElementById('balance').innerText = `Баланс: ${balanceEth.toFixed(6)} ETH`;

                    // Получение конвертированных значений
                    const rates = await getExchangeRates();
                    const rub = balanceEth * rates.ethToRub;
                    const usd = balanceEth * rates.ethToUsd;
                    const eur = balanceEth * rates.ethToEur;
                    const cny = balanceEth * rates.ethToCny;

                    // Отображение всех валютных балансов с символами валют
                    document.getElementById('rub').innerText = rub.toFixed(2);
                    document.getElementById('usd').innerText = usd.toFixed(2);
                    document.getElementById('eur').innerText = eur.toFixed(2);
                    document.getElementById('cny').innerText = cny.toFixed(2);
                    document.getElementById('currencyBalances').style.display = 'block';
                })
                .catch((error) => {
                    console.error(error);
                    document.getElementById('balance').innerText = 'Ошибка при подключении';
                });
        }

        // Получение актуальных курсов валют
        async function getExchangeRates() {
            try {
                const response = await fetch('https://min-api.cryptocompare.com/data/price?fsym=ETH&tsyms=USD,RUB,EUR,CNY');
                const data = await response.json();

                return {
                    ethToUsd: data.USD,
                    ethToRub: data.RUB,
                    ethToEur: data.EUR,
                    ethToCny: data.CNY
                };
            } catch (error) {
                console.error('Ошибка при получении курсов валют:', error);
                return { ethToUsd: 0, ethToRub: 0, ethToEur: 0, ethToCny: 0 }; // Возврат нулевых курсов в случае ошибки
            }
        }
    </script>
</body>
</html>
