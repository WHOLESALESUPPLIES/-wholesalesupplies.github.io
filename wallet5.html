<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src='https://kit.fontawesome.com/a076d05399.js' crossorigin='anonymous'></script>
    <style>
        body {font-family: monospace; padding: 20px;}
        .balance {margin-top: 20px;}
        select {margin-top: 20px; padding: 5px; font-size: 16px;}
    </style>
</head>
<body>
    <div class="balance">
        <ul id="currencyBalances" style="display: none;">
            <li><strong> (ETH): </strong><span id="eth"></span> <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="10" height="20" viewBox="0 0 50 50" style="position: relative;top: 6px;left: -2px;"><path d="M 25.984375 0.98632812 A 1.0001 1.0001 0 0 0 25.099609 1.5527344 L 11.169922 23.443359 A 1.0009551 1.0009551 0 0 0 11.107422 23.548828 A 1.0009551 1.0009551 0 0 0 11.105469 23.550781 A 1.0001 1.0001 0 0 0 11.066406 23.640625 A 1.0009551 1.0009551 0 0 0 11.013672 23.833984 A 1.0001 1.0001 0 0 0 11 24.033203 A 1.0009551 1.0009551 0 0 0 11 24.035156 A 1.0001 1.0001 0 0 0 11.007812 24.132812 A 1.0009551 1.0009551 0 0 0 11.011719 24.152344 A 1.0001 1.0001 0 0 0 11.046875 24.298828 A 1.0001 1.0001 0 0 0 11.054688 24.326172 A 1.0009551 1.0009551 0 0 0 11.054688 24.328125 A 1.0001 1.0001 0 0 0 11.091797 24.419922 A 1.0009551 1.0009551 0 0 0 11.091797 24.421875 A 1.0001 1.0001 0 0 0 11.138672 24.507812 A 1.0009551 1.0009551 0 0 0 11.138672 24.509766 A 1.0001 1.0001 0 0 0 11.193359 24.591797 A 1.0009551 1.0009551 0 0 0 11.222656 24.626953 A 1.0001 1.0001 0 0 0 11.257812 24.669922 A 1.0001 1.0001 0 0 0 11.326172 24.740234 A 1.0009551 1.0009551 0 0 0 11.328125 24.742188 A 1.0009551 1.0009551 0 0 0 11.486328 24.859375 A 1.0009551 1.0009551 0 0 0 11.488281 24.861328 A 1.0001 1.0001 0 0 0 11.503906 24.869141 A 1.0009551 1.0009551 0 0 0 11.505859 24.871094 L 25.378906 32.798828 A 1.0001 1.0001 0 0 0 26.613281 32.802734 L 40.474609 24.880859 A 1.0009551 1.0009551 0 0 0 40.496094 24.869141 A 1.0001 1.0001 0 0 0 40.560547 24.828125 A 1.0009551 1.0009551 0 0 0 40.580078 24.814453 A 1.0001 1.0001 0 0 0 40.59375 24.802734 A 1.0009551 1.0009551 0 0 0 40.654297 24.757812 A 1.0009551 1.0009551 0 0 0 40.658203 24.753906 A 1.0001 1.0001 0 0 0 40.669922 24.744141 A 1.0009551 1.0009551 0 0 0 40.730469 24.683594 A 1.0009551 1.0009551 0 0 0 40.794922 24.607422 A 1.0009551 1.0009551 0 0 0 40.849609 24.527344 A 1.0009551 1.0009551 0 0 0 40.851562 24.525391 A 1.0001 1.0001 0 0 0 40.853516 24.519531 A 1.0009551 1.0009551 0 0 0 40.900391 24.439453 A 1.0009551 1.0009551 0 0 0 40.900391 24.4375 A 1.0001 1.0001 0 0 0 40.931641 24.367188 A 1.0009551 1.0009551 0 0 0 40.939453 24.345703 A 1.0001 1.0001 0 0 0 40.947266 24.322266 A 1.0009551 1.0009551 0 0 0 40.966797 24.253906 A 1.0009551 1.0009551 0 0 0 40.96875 24.25 A 1.0001 1.0001 0 0 0 40.970703 24.244141 A 1.0009551 1.0009551 0 0 0 40.988281 24.152344 A 1.0001 1.0001 0 0 0 40.998047 24.076172 A 1.0009551 1.0009551 0 0 0 40.998047 24.068359 A 1.0001 1.0001 0 0 0 41 23.976562 A 1.0001 1.0001 0 0 0 40.996094 23.917969 A 1.0009551 1.0009551 0 0 0 40.990234 23.855469 A 1.0009551 1.0009551 0 0 0 40.990234 23.853516 A 1.0001 1.0001 0 0 0 40.988281 23.84375 A 1.0009551 1.0009551 0 0 0 40.970703 23.759766 A 1.0009551 1.0009551 0 0 0 40.970703 23.755859 A 1.0001 1.0001 0 0 0 40.949219 23.681641 A 1.0009551 1.0009551 0 0 0 40.941406 23.660156 A 1.0001 1.0001 0 0 0 40.931641 23.636719 A 1.0009551 1.0009551 0 0 0 40.904297 23.570312 A 1.0009551 1.0009551 0 0 0 40.902344 23.568359 A 1.0001 1.0001 0 0 0 40.900391 23.5625 A 1.0009551 1.0009551 0 0 0 40.853516 23.480469 A 1.0001 1.0001 0 0 0 40.847656 23.470703 A 1.0009551 1.0009551 0 0 0 40.84375 23.462891 L 40.8125 23.416016 L 26.896484 1.546875 A 1.0001 1.0001 0 0 0 25.984375 0.98632812 z M 25 5.4355469 L 25 17.339844 L 14.583984 21.802734 L 25 5.4355469 z M 27 5.4355469 L 37.416016 21.802734 L 27 17.339844 L 27 5.4355469 z M 25 19.515625 L 25 30.275391 L 14.242188 24.128906 L 25 19.515625 z M 27 19.515625 L 37.757812 24.128906 L 27 30.275391 L 27 19.515625 z M 40.007812 27.998047 A 1.0001 1.0001 0 0 0 39.503906 28.130859 L 26 35.847656 L 12.496094 28.130859 A 1.0001 1.0001 0 0 0 12.019531 28 A 1.0001 1.0001 0 0 0 11.195312 29.59375 L 25.128906 48.503906 A 1.0001 1.0001 0 0 0 26.869141 48.505859 L 40.804688 29.59375 A 1.0001 1.0001 0 0 0 40.007812 27.998047 z M 15.613281 32.216797 L 25 37.582031 L 25 44.957031 L 15.613281 32.216797 z M 36.386719 32.216797 L 27 44.957031 L 27 37.582031 L 36.386719 32.216797 z"></path></svg></li>
            <li><strong> (RUB): </strong><span id="rub"></span> ₽</li>
            <li><strong> (USD): </strong><span id="usd"></span> $</li>
            <li><strong> (EUR): </strong><span id="eur"></span> €</li>
            <li><strong> (CNY): </strong><span id="cny"></span> 元</li>
            <li><strong> (GHS): </strong><span id="ghs"></span> ₵</li>
            <li><strong> (NGN): </strong><span id="ngn"></span> ₦</li>
            <li><strong> (KES): </strong><span id="kes"></span> KSh</li>
            <li><strong> (ZAR): </strong><span id="zar"></span> R</li>
        </ul>
    </div>

    <script>
        // Проверка наличия MetaMask
        if (typeof window.ethereum === 'undefined') {
            document.getElementById('balance').innerText = 'wallet not connected';
        } else {
            const updateBalances = async () => {
                try {
                    const web3 = new Web3(window.ethereum);
                    const accounts = await web3.eth.getAccounts();
                    const account = accounts[0];

                    // Получаем баланс в Wei и конвертируем в Ether
                    const balanceWei = await web3.eth.getBalance(account);
                    const balanceEth = parseFloat(web3.utils.fromWei(balanceWei, 'ether'));

                    // Проверка корректности суммы
                    if (isNaN(balanceEth)) {
                        document.getElementById('balance').innerText = 'Ошибка: неверный баланс';
                        return;
                    }

                    // Обновляем баланс на странице
                    document.getElementById('eth').innerText = balanceEth.toFixed(6);

                    // Получение конвертированных значений
                    const rates = await getExchangeRates();
                    const rub = balanceEth * rates.ethToRub;
                    const usd = balanceEth * rates.ethToUsd;
                    const eur = balanceEth * rates.ethToEur;
                    const cny = balanceEth * rates.ethToCny;
                    const ghs = usd * rates.usdToGhs;
                    const ngn = usd * rates.usdToNgn;
                    const kes = usd * rates.usdToKes;
                    const zar = usd * rates.usdToZar;

                    // Форматирование чисел с пробелами в качестве разделителя тысяч
                    const formatNumber = (num) => {
                        return num.toFixed(1).replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
                    };

                    // Отображение всех валютных балансов с символами валют
                    document.getElementById('rub').innerText = formatNumber(rub);
                    document.getElementById('usd').innerText = formatNumber(usd);
                    document.getElementById('eur').innerText = formatNumber(eur);
                    document.getElementById('cny').innerText = formatNumber(cny);
                    document.getElementById('ghs').innerText = formatNumber(ghs);
                    document.getElementById('ngn').innerText = formatNumber(ngn);
                    document.getElementById('kes').innerText = formatNumber(kes);
                    document.getElementById('zar').innerText = formatNumber(zar);
                    document.getElementById('currencyBalances').style.display = 'block';
                } catch (error) {
                    console.error(error);
                    document.getElementById('balance').innerText = 'Ошибка при обновлении баланса';
                }
            };

            // Обновляем балансы при загрузке страницы и затем каждую минуту
            updateBalances();
            setInterval(updateBalances, 60000);
        }

        // Получение актуальных курсов валют из CoinGecko и ExchangeRate-API
        async function getExchangeRates() {
            try {
                // Используем ExchangeRate-API для получения курсов USD → GHS, NGN, KES, ZAR
                const exchangeRateResponse = await fetch('https://v6.exchangerate-api.com/v6/58dc3def9033dec59baf1b26/latest/USD');
                const exchangeRateData = await exchangeRateResponse.json();

                const usdToGhs = exchangeRateData.conversion_rates.GHS;
                const usdToNgn = exchangeRateData.conversion_rates.NGN;
                const usdToKes = exchangeRateData.conversion_rates.KES;
                const usdToZar = exchangeRateData.conversion_rates.ZAR;

                // Получение курсов через CoinGecko для других валют
                const coingeckoResponse = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=usd,rub,eur,cny');
                const coingeckoData = await coingeckoResponse.json();

                return {
                    ethToUsd: coingeckoData.ethereum.usd || 0,
                    ethToRub: coingeckoData.ethereum.rub || 0,
                    ethToEur: coingeckoData.ethereum.eur || 0,
                    ethToCny: coingeckoData.ethereum.cny || 0,
                    usdToGhs: usdToGhs || 0,
                    usdToNgn: usdToNgn || 0,
                    usdToKes: usdToKes || 0,
                    usdToZar: usdToZar || 0,
                };
            } catch (error) {
                console.error('Ошибка при получении курсов валют:', error);
                return { 
                    ethToUsd: 0, ethToRub: 0, ethToEur: 0, ethToCny: 0,
                    usdToGhs: 0, usdToNgn: 0, usdToKes: 0, usdToZar: 0
                }; // Возврат нулевых курсов в случае ошибки
            }
        }
    </script>
</body>
</html>
